
&НаКлиенте
Процедура Тест1(Команда)
	Тест1НаСервере(ИмяФайла);
КонецПроцедуры

&НаСервереБезКонтекста
Процедура Тест1НаСервере(ИмяФайла)
	
	Начало = ТекущаяУниверсальнаяДатаВМиллисекундах();
	
	Если Не ПодключитьВнешнююКомпоненту(ИмяФайла, "Test", ТипВнешнейКомпоненты.Native, ТипПодключенияВнешнейКомпоненты.НеИзолированно) Тогда 
		Сообщить("Не удалось подключить");
		Возврат;
	КонецЕсли;
	
	Сообщить("Подключена");
	ОбъектКомпоненты = Новый ("AddIn.Test.Class1");
	Test = ОбъектКомпоненты.Test;
	Конец = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Сообщить(СтрШаблон("Test: %1", Test));
	Сообщить(СтрШаблон("Длительность: %1", Конец - Начало));
	
КонецПроцедуры


&НаКлиенте
Процедура Тест2(Команда)
	Тест2НаСервере(ИмяФайла);
КонецПроцедуры

&НаСервереБезКонтекста
Процедура Тест2НаСервере(ИмяФайла) 
	
	Начало = ТекущаяУниверсальнаяДатаВМиллисекундах();
	
	Попытка
		ОбъектКомпоненты = Новый ("AddIn.Test.Class1");
	Исключение
		Если Не ПодключитьВнешнююКомпоненту(ИмяФайла, "Test", ТипВнешнейКомпоненты.Native, ТипПодключенияВнешнейКомпоненты.НеИзолированно) Тогда 
			ВызватьИсключение "Не удалось подключить";
		КонецЕсли;
		ОбъектКомпоненты = Новый ("AddIn.Test.Class1");
	КонецПопытки;
	
	ОбъектКомпоненты.PropI32 = 123;
	Если ОбъектКомпоненты.PropI32 <> 123 Тогда
		ВызватьИсключение "Не удалось установить значение PropI32";
	КонецЕсли; 
	
	ОбъектКомпоненты.PropF64 = 456.789;
	Если ОбъектКомпоненты.PropF64 <> 456.789 Тогда
		ВызватьИсключение "Не удалось установить значение PropF64";
	КонецЕсли;
	
	ОбъектКомпоненты.PropBool = Истина;
	Если ОбъектКомпоненты.PropBool <> Истина Тогда
		ВызватьИсключение "Не удалось установить значение PropBool";
	КонецЕсли;
	
	Date = ТекущаяДатаСеанса();
	ОбъектКомпоненты.PropDate = Date;
	Если ОбъектКомпоненты.PropDate <> Date Тогда
		ВызватьИсключение "Не удалось установить значение PropDate";
	КонецЕсли;
	
	ОбъектКомпоненты.PropStr = "Привет!";
	Если ОбъектКомпоненты.PropStr <> "Привет!" Тогда
		ВызватьИсключение "Не удалось установить значение PropStr";
	КонецЕсли;
	
	Blob = ПолучитьДвоичныеДанныеИзСтроки("Привет!");
	ОбъектКомпоненты.PropBlob = Blob;
	Если ОбъектКомпоненты.PropBlob <> Blob Тогда
		ВызватьИсключение "Не удалось установить значение PropBlob";
	КонецЕсли;
	
	Если ОбъектКомпоненты.Method1("11", "22", "33") <> "112233" Тогда
		ВызватьИсключение "Не удалось установить значение Method1";
	КонецЕсли;
	
	ВозвращаемаяСтрока = Неопределено;
	ВозвращаемоеЧисло = Неопределено;
	Если Не ОбъектКомпоненты.Method2(ВозвращаемаяСтрока, ВозвращаемоеЧисло) 
		Или ВозвращаемаяСтрока <> "Return value"
		Или ВозвращаемоеЧисло <> 1 Тогда
		ВызватьИсключение "Не удалось вызвать Method2";
	КонецЕсли;
	
	Конец = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Сообщить(СтрШаблон("Длительность: %1", Конец - Начало));
	
КонецПроцедуры

&НаКлиенте
Процедура Тест3(Команда)
	Тест3НаСервере(ИмяФайла);
КонецПроцедуры

&НаСервереБезКонтекста
Процедура Тест3НаСервере(ИмяФайла)
	
	Попытка
		ОбъектКомпоненты2 = Новый ("AddIn.Test.Class2");
	Исключение
		Если Не ПодключитьВнешнююКомпоненту(ИмяФайла, "Test", ТипВнешнейКомпоненты.Native, ТипПодключенияВнешнейКомпоненты.НеИзолированно) Тогда 
			ВызватьИсключение "Не удалось подключить";
		КонецЕсли;
		ОбъектКомпоненты2 = Новый ("AddIn.Test.Class2");
	КонецПопытки;
	
	Если ОбъектКомпоненты2.Method1(111) <> 222 Тогда
		ВызватьИсключение "Не удалось вызвать Method1";
	КонецЕсли;
	
	Попытка
		ОбъектКомпоненты2.Method1("3213");
		ВызватьИсключение "Method1 не вызвал исключение";
	Исключение
		Если ОбъектКомпоненты2.LastError <> "Incompatible type" Тогда
			ВызватьИсключение "Method1 не вернул текст ошибки";
		КонецЕсли;
	КонецПопытки;
	
	Если ОбъектКомпоненты2.Method2(111, 222) <> 333 Тогда
		ВызватьИсключение "Не удалось вызвать Method2";	
	КонецЕсли;
	
	Если ОбъектКомпоненты2.Prop1 <> 333 Тогда
		ВызватьИсключение "Свойство Prop1 содержит неверное значение";
	КонецЕсли;
	
	Попытка
		ОбъектКомпоненты2.Panic1();
	Исключение
		Если ОбъектКомпоненты2.LastError <> "Panic1" Тогда
			ВызватьИсключение "Panic1 не вернул текст ошибки";
		КонецЕсли;
	КонецПопытки;
	
	Попытка
		ОбъектКомпоненты2.Prop1 = 2;
		ОбъектКомпоненты2.Panic2();
	Исключение
		Если ОбъектКомпоненты2.LastError <> "Panic2" Тогда
			ВызватьИсключение "Panic2 не вернул текст ошибки";
		КонецЕсли;
	КонецПопытки;
	
	Сообщить("Тест выполнен успешно");
	
КонецПроцедуры

&НаКлиенте
Процедура Тест4(Команда)
	Тест4НаСервере(ИмяФайла);
КонецПроцедуры

&НаСервереБезКонтекста
Процедура Тест4НаСервере(ИмяФайла)
	
	Попытка
		ОбъектКомпоненты2 = Новый ("AddIn.Test.Class2");
	Исключение
		Если Не ПодключитьВнешнююКомпоненту(ИмяФайла, "Test", ТипВнешнейКомпоненты.Native, ТипПодключенияВнешнейКомпоненты.НеИзолированно) Тогда 
			ВызватьИсключение "Не удалось подключить";
		КонецЕсли;
		ОбъектКомпоненты2 = Новый ("AddIn.Test.Class2");
	КонецПопытки;
	
	Начало = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Для К = 1 По 1000000 Цикл
		ОбъектКомпоненты2.Prop1 = 123;
	КонецЦикла;
	Конец = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Сообщить(СтрШаблон("Длительность: %1 мс", Конец - Начало));
	
КонецПроцедуры

&НаКлиенте
Процедура Тест5(Команда)
	Тест5НаСервере(ИмяФайла);
КонецПроцедуры

&НаСервереБезКонтекста
Процедура Тест5НаСервере(ИмяФайла)
	
	Попытка
		ОбъектКомпоненты2 = Новый ("AddIn.Test.Class2");
	Исключение
		Если Не ПодключитьВнешнююКомпоненту(ИмяФайла, "Test", ТипВнешнейКомпоненты.Native, ТипПодключенияВнешнейКомпоненты.НеИзолированно) Тогда 
			ВызватьИсключение "Не удалось подключить";
		КонецЕсли;
		ОбъектКомпоненты2 = Новый ("AddIn.Test.Class2");
	КонецПопытки;
	
	Начало = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Для К = 1 По 1000000 Цикл
		ОбъектКомпоненты2.Method1(111);
	КонецЦикла;
	Конец = ТекущаяУниверсальнаяДатаВМиллисекундах();
	Сообщить(СтрШаблон("Длительность: %1 мс", Конец - Начало));
	
КонецПроцедуры
